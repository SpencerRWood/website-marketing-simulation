# ============================================================
# Simulation Runtime Configuration
# ============================================================

run:
  run_id: "auto"           # If "auto", generated at runtime. Attached to all outputs.
  seed: 123                # Master RNG seed (guarantees deterministic runs).
  start_date: "2026-01-01" # Simulation start date (UTC).
  num_days: 30             # Number of simulated calendar days.


# ============================================================
# Storage (Cold Layer)
# ============================================================

storage:
  duckdb_path: "data/sim.duckdb"  # Cold storage sink.
  clean_slate: true               # If true, database is recreated per run.
  flush:
    every_n_events: 5000
    or_every_seconds: 30


# ============================================================
# Logging
# ============================================================

logging:
  level: "INFO"  # Structured logging level.


# ============================================================
# Users (Hot Layer Behavioral Engine)
# ============================================================

users:

  # Probability that a new intent creates a brand-new user.
  # If users already exist:
  #   With probability new_user_share → create new user.
  #   Otherwise → select an existing user via weighted sampling.
  new_user_share: 0.85


  # ----------------------------------------------------------
  # Returning User Selection Model
  # ----------------------------------------------------------
  selection:

    # Currently supported mode:
    # "recency_propensity_weighted"
    #
    # Weight formula:
    #
    #   weight_i =
    #       recency_weight * recency_score_i
    #     + propensity_weight * propensity_i
    #
    # where:
    #   recency_score_i = exp(-ln(2) * age_hours / half_life)
    #
    # So:
    #   age = half_life → score = 0.5
    #   age = 2*half_life → score = 0.25
    #
    mode: "recency_propensity_weighted"

    # Half-life (in hours) for recency decay.
    recency_half_life_hours: 18

    # Weight assigned to latent user propensity (0–1).
    propensity_weight: 0.5

    # Weight assigned to recency score.
    recency_weight: 0.5


  # ----------------------------------------------------------
  # Latent Propensity Distribution (User Heterogeneity)
  # ----------------------------------------------------------
  propensity:
    init:
      # Distribution used when creating a new user.
      # "uniform" → U(0,1)
      # "beta"    → Beta(alpha, beta)
      dist: "beta"

      # Beta(alpha, beta) parameters.
      # Mean = alpha / (alpha + beta)
      # (2,6) → mean ≈ 0.25
      alpha: 2.0
      beta: 6.0


  # ----------------------------------------------------------
  # Discovery Mode (New User State)
  # ----------------------------------------------------------
  discovery_mode:
    enabled: true
    graduation_sessions: 2
    dropoff_multiplier: 1.25
    conversion_logit_shift: -0.8


# ============================================================
# Intent Resolver
# ============================================================

intent_resolver:
  enabled: true


# ============================================================
# Arrivals
# ============================================================

arrivals:
  baseline_arrivals:
    model: "nhpp"
    daily_expected_intents: 2000
    intraday_curve:
      type: "gaussian_peak"
      peak_hour: 12.0
      spread_hours: 3.0
      floor: 0.05


# ============================================================
# Site Graph
# ============================================================

site_graph:
  pages:
    home:
      dropoff_p: 0.25
      transitions:
        - ["product", 0.55]
        - ["pricing", 0.25]

    product:
      dropoff_p: 0.15
      transitions:
        - ["pricing", 0.35]
        - ["home", 0.10]

    pricing:
      dropoff_p: 0.20
      transitions:
        - ["checkout", 0.35]
        - ["home", 0.10]

    checkout:
      dropoff_p: 0.30
      transitions: []


# ============================================================
# Sessions
# ============================================================

sessions:
  inactivity_timeout_minutes: 30
  max_steps: null
  entry_page: "home"

  inter_page_time:
    # Options: fixed | exponential
    dist: "exponential"
    fixed_seconds: 10.0
    mean_seconds: 10.0


# ============================================================
# Conversion
# ============================================================

conversion:
  # Currently supported: "logistic"
  model: "logistic"

  # Hard cap on conversion probability per session.
  cap: 0.35

  # Baseline log-odds of conversion for an average user.
  # -3.0 => ~4.7% before propensity + discovery modifiers
  base_logit: -3.0

  # Multiplier on user propensity in logit space.
  propensity_coef: 2.0
